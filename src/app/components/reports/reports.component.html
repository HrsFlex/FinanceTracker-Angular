<div class="container mx-auto p-4">
  <h1 class="text-2xl font-bold mb-4">Financial Reports</h1>
  <p class="text-sm text-gray-600 mb-4">Last updated: {{ lastUpdated }}</p>

  <!-- Filters -->
  <form [formGroup]="reportForm" class="mb-6 p-4 bg-gray-100 rounded-lg shadow">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
      <mat-form-field>
        <mat-label>Account</mat-label>
        <mat-select formControlName="accountId">
          <mat-option *ngFor="let account of accounts" [value]="account.id">{{
            account.name
          }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Category</mat-label>
        <mat-select formControlName="categoryId">
          <mat-option
            *ngFor="let category of categories"
            [value]="category.value"
            >{{ category.label }}</mat-option
          >
        </mat-select>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Type</mat-label>
        <mat-select formControlName="type">
          <mat-option value="all">All</mat-option>
          <mat-option value="income">Income</mat-option>
          <mat-option value="expense">Expense</mat-option>
          <mat-option value="transfer">Transfer</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-button-toggle-group
        [value]="reportType"
        (change)="setReportType($event.value)"
      >
        <mat-button-toggle value="daily">Daily</mat-button-toggle>
        <mat-button-toggle value="weekly">Weekly</mat-button-toggle>
        <mat-button-toggle value="monthly">Monthly</mat-button-toggle>
        <mat-button-toggle value="custom">Custom</mat-button-toggle>
      </mat-button-toggle-group>
    </div>

    <div *ngIf="reportType === 'custom'" class="flex gap-4 mt-4">
      <mat-form-field class="w-48">
        <mat-label>Start Date</mat-label>
        <input
          matInput
          [matDatepicker]="startPicker"
          (dateInput)="setCustomDateRange($event, 'start')"
        />
        <mat-datepicker-toggle
          matSuffix
          [for]="startPicker"
        ></mat-datepicker-toggle>
        <mat-datepicker #startPicker></mat-datepicker>
      </mat-form-field>

      <mat-form-field class="w-48">
        <mat-label>End Date</mat-label>
        <input
          matInput
          [matDatepicker]="endPicker"
          (dateInput)="setCustomDateRange($event, 'end')"
        />
        <mat-datepicker-toggle
          matSuffix
          [for]="endPicker"
        ></mat-datepicker-toggle>
        <mat-datepicker #endPicker></mat-datepicker>
      </mat-form-field>
    </div>

    <button
      mat-raised-button
      color="accent"
      (click)="downloadPDF()"
      class="mt-4"
    >
      Download PDF
    </button>
  </form>

  <!-- Chart -->
  <div class="mb-6">
    <div *ngIf="loading" class="text-center text-gray-500">
      Loading chart...
    </div>
    <div
      *ngIf="!loading && summaries.length === 0"
      class="text-center text-gray-500"
    >
      No data available for the selected filters.
    </div>
    <canvas
      id="reportChart"
      class="w-full h-96"
      *ngIf="!loading && summaries.length > 0"
    ></canvas>
  </div>

  <!-- Summary Table -->
  <table mat-table [dataSource]="summaries" class="w-full">
    <ng-container matColumnDef="date">
      <th mat-header-cell *matHeaderCellDef>Date</th>
      <td mat-cell *matCellDef="let summary">{{ summary.date }}</td>
    </ng-container>
    <ng-container matColumnDef="income">
      <th mat-header-cell *matHeaderCellDef>Income</th>
      <td mat-cell *matCellDef="let summary">
        {{ summary.income | currency }}
      </td>
    </ng-container>
    <ng-container matColumnDef="expense">
      <th mat-header-cell *matHeaderCellDef>Expense</th>
      <td mat-cell *matCellDef="let summary">
        {{ summary.expense | currency }}
      </td>
    </ng-container>
    <ng-container matColumnDef="transfer">
      <th mat-header-cell *matHeaderCellDef>Transfer</th>
      <td mat-cell *matCellDef="let summary">
        {{ summary.transfer | currency }}
      </td>
    </ng-container>
    <ng-container matColumnDef="net">
      <th mat-header-cell *matHeaderCellDef>Net</th>
      <td mat-cell *matCellDef="let summary">{{ summary.net | currency }}</td>
    </ng-container>
    <tr
      mat-header-row
      *matHeaderRowDef="['date', 'income', 'expense', 'transfer', 'net']"
    ></tr>
    <tr
      mat-row
      *matRowDef="
        let row;
        columns: ['date', 'income', 'expense', 'transfer', 'net']
      "
    ></tr>
  </table>
</div>
